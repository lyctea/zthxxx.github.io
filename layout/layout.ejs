<%- partial('common/head') %>
<body>
    <% if (theme.customize.opacity.enable) { %>
        <script type="text/javascript">
            function getUrlParam(paramName) {
                var paramValue = "", isFound = !1;
                if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) {
                    arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&"), i = 0;
                    while (i < arrSource.length && !isFound) arrSource[i].indexOf("=") > 0 && arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase() && (paramValue = arrSource[i].split("=")[1], isFound = !0), i++;
                }
                if (paramValue == "") paramValue = undefined;
                return paramValue;
            }
            function setRandomBackImg() {
                var img_path = "<%- theme.customize.opacity.background_images_path %>";
                var horizontal_img_count = <%- theme.customize.opacity.background_images_count.horizontal_img_count %>;
                var vertical_img_count = <%- theme.customize.opacity.background_images_count.vertical_img_count %>;
                if (window.innerWidth > window.innerHeight) {
                    var background_image_index = ~~(Math.random() * horizontal_img_count);
                    img_path += "horizontal/";
                    document.body.style.backgroundImage = "url(" + img_path + "img_" + background_image_index + ".jpg)";
                } else {
                    var background_image_index = ~~(Math.random() * vertical_img_count);
                    img_path += "vertical/";
                    document.body.style.backgroundImage = "url(" + img_path + "img_" + background_image_index + ".jpg)";
                }
            }
            function setIcarusOpacityStyle(enable) {
                if (enable == "true") {
                    setRandomBackImg();
                    $("head").append("<link>").children(":last").attr({rel: "stylesheet", type: "text/css", href: "/css/style-opacity.css"});
                } else {
                    document.body.style.backgroundImage = "none";
                    $('link[rel="stylesheet"][href$="/css/style-opacity.css"]').remove();
                }
            }
            function setStyleReverseTag() {
                $("a[href='javascript:reverseIcarusOpacity();']").each(
                    function() {
                        this.text = $.cookie("icarus_opacity") == "true" ? "表世界" : "里世界" ;
                    }
                );
            }
            function reverseIcarusOpacity() {
                if ($.cookie("icarus_opacity") == "false") {
                    $.cookie("icarus_opacity", "true", { expires: 365, path: '/' });
                    setIcarusOpacityStyle("true");
                } else {
                    $.cookie("icarus_opacity", "false", { expires: 365, path: '/' });
                    setIcarusOpacityStyle("false");
                }
                setStyleReverseTag();
            }
            if (getUrlParam("icarus_opacity") == "false") {
                $.cookie("icarus_opacity", "false", { expires: 365, path: '/' });
            } else if (getUrlParam("icarus_opacity") == "true") {
                $.cookie("icarus_opacity", "true", { expires: 365, path: '/' });
            }
            setIcarusOpacityStyle($.cookie("icarus_opacity"));
            $(setStyleReverseTag);
        </script>
    <% } %>
    <div id="container">
        <%- partial('common/header') %>
        <div class="outer">
            <% if (theme.customize.profile.enabled) { %>
                <%- partial('common/profile', null, {cache: !config.relative_link}) %>
            <% } %>
            <section id="main"><%- body %></section>
            <% if (theme.customize.sidebar) { %>
                <%- partial('common/sidebar', null, {cache: !config.relative_link}) %>
            <% } %>
        </div>
        <%- partial('common/footer', null, {cache: !config.relative_link}) %>
        <%- partial('common/scripts') %>
    </div>
</body>
</html>